{% extends 'base.html' %}
{% load static %}
{% load recipe_extras %}

{% block title %}{{ recipe.title }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <div class="card">
            {% if recipe.image %}
                <img src="{{ recipe.image.url }}" class="card-img-top" alt="{{ recipe.title }}">
            {% endif %}
            <div class="card-body">
                <h1 class="card-title">{{ recipe.title }}</h1>
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div>
                        {% for category in recipe.categories.all %}
                            <span class="badge bg-primary me-1">{{ category.name }}</span>
                        {% endfor %}
                        <span class="badge bg-secondary">{{ recipe.get_difficulty_display }}</span>
                    </div>
                    {% comment %} <div>
                        <a href="{% url 'recipe_update' recipe.slug %}" class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-edit"></i> Edit
                        </a>
                        <a href="{% url 'recipe_delete' recipe.slug %}" class="btn btn-outline-danger btn-sm">
                            <i class="fas fa-trash"></i> Delete
                        </a>
                    </div> {% endcomment %}
                </div>

                <div class="row mb-4">
                    <div class="col-sm-4">
                        <div class="text-center">
                            <i class="fas fa-clock fa-2x mb-2"></i>
                            <p class="mb-0"><strong>Prep Time</strong></p>
                            <p>{{ recipe.preparation_time }} min</p>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="text-center">
                            <i class="fas fa-fire fa-2x mb-2"></i>
                            <p class="mb-0"><strong>Cook Time</strong></p>
                            <p>{{ recipe.cooking_time }} min</p>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="text-center">
                            <i class="fas fa-users fa-2x mb-2"></i>
                            <p class="mb-0"><strong>Servings</strong></p>
                            <p>{{ recipe.servings }}</p>
                        </div>
                    </div>
                </div>
                
                <div class="text-center mb-3">
                    <a href="{% url 'recipe_calories_detail' recipe.slug %}" class="btn btn-info">
                        <i class="fas fa-chart-pie"></i> Nutritional Information
                    </a>
                </div>

                <h4>Description</h4>
                <p>{{ recipe.description }}</p>

                <div class="row">
                    <div class="col-md-12">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h4 class="mb-0">
                                    <i class="fas fa-list me-2"></i>Ingredients
                                </h4>
                            </div>
                            <div class="card-body p-0">
                                {{ recipe.get_ingredients_with_sections|safe }}
                            </div>
                        </div>
                    </div>
                </div>

                <h4>Instructions</h4>
                <div class="mb-4">
                    {% for instruction in recipe.instructions.splitlines %}
                        {% if instruction|length > 0 %}
                            <div class="mb-3">
                                <div class="d-flex">
                                    <span class="badge bg-secondary me-2">{{ forloop.counter }}</span>
                                    <p class="mb-0">{{ instruction }}</p>
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
        {% if total_nutrition %}
    <div class="col-md-12 mt-4">
        <div class="card">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-5">
                            <h4>Detailed Nutrition Breakdown</h4>
                        <b>Macronutrients</b>
                        <ul class="list-group">
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                Calories
                                <span class="badge bg-primary rounded-pill">{{ total_nutrition|get_item:'calories'|floatformat:2 }} kcal</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                Protein
                                <span class="badge bg-success rounded-pill">{{ total_nutrition|get_item:'protein'|floatformat:2 }} g</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                Carbohydrates
                                <span class="badge bg-warning rounded-pill">{{ total_nutrition|get_item:'carbohydrates'|floatformat:2 }} g</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                Fat
                                <span class="badge bg-danger rounded-pill">{{ total_nutrition|get_item:'fat'|floatformat:2 }} g</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                Fiber
                                <span class="badge bg-info rounded-pill">{{ total_nutrition|get_item:'fiber'|floatformat:2 }} g</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                Salt
                                <span class="badge bg-secondary rounded-pill">{{ total_nutrition|get_item:'salt'|floatformat:2 }} g</span>
                            </li>
                        </ul>
                        <div class="text-muted small mt-3 text-center">
                            * Based on a 2,000 calorie diet. Individual needs may vary.
                        </div>
                    </div>
                    
                </div>

            </div>
        </div>
    </div>
    {% endif %}
    </div>

    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Tips</h5>
            </div>
            <div class="card-body">
                <ul class="list-unstyled mb-0">
                    <li class="mb-2">
                        <i class="fas fa-info-circle text-info me-2"></i>
                        Read through the entire recipe before starting.
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-temperature-high text-warning me-2"></i>
                        Preheat your oven if required.
                    </li>
                    <li>
                        <i class="fas fa-balance-scale text-success me-2"></i>
                        Measure ingredients accurately.
                    </li>
                </ul>
            </div>
        </div>

        {% if recipe.related_terms.exists %}
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Glossary</h5>
                </div>
                <div class="card-body">
                    {% for term in recipe.related_terms.all %}
                        <h6>{{ term.name }}</h6>
                        <p class="mb-3">{{ term.description|truncatewords:30 }}</p>
                    {% endfor %}
                </div>
            </div>
        {% endif %}
    </div>

    
</div>
{% endblock %}

{% block extra_css %}
<style>
    .ingredients-list {
        line-height: 1.8;
    }
    .ingredients-list .list-group-item {
        border-left: none;
        border-right: none;
        border-radius: 0 !important;
        padding: 0.75rem 1rem;
        text-align: left;
    }
    .ingredients-list .list-group-item:first-child {
        border-top: none;
    }
    .ingredients-list .list-group-item:last-child {
        border-bottom: none;
    }
    .glossary-link {
        color: #0d6efd;
        text-decoration: none;
        border-bottom: 1px dashed #0d6efd;
    }
    .glossary-link:hover {
        text-decoration: none;
        border-bottom: 1px solid #0d6efd;
    }
    .recipe-link {
        color: #198754;
        text-decoration: none;
        border-bottom: 1px dashed #198754;
    }
    .recipe-link:hover {
        text-decoration: none;
        border-bottom: 1px solid #198754;
        color: #157347;
    }
    .ingredient-section {
        margin-bottom: 1rem;
    }
    .ingredient-section-heading {
        background-color: #f8f9fa;
        padding: 0.5rem 1rem;
        margin: 0;
        border-bottom: 1px solid #e9ecef;
        color: #6c757d;
        font-weight: 600;
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl)
        });
    });
</script>
{% endblock %}
